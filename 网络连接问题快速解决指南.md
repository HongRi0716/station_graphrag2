# ç½‘ç»œè¿æ¥é—®é¢˜å¿«é€Ÿè§£å†³æŒ‡å—

## ğŸ” é—®é¢˜ç¡®è®¤

æµ‹è¯•ç»“æœæ˜¾ç¤ºï¼š**æ— æ³•è¿æ¥åˆ° Google API æœåŠ¡å™¨**

- æ‰€æœ‰ TCP è¿æ¥å°è¯•å¤±è´¥
- Ping è¶…æ—¶
- è¯´æ˜ç½‘ç»œç¯å¢ƒæ— æ³•ç›´æ¥è®¿é—® Google æœåŠ¡

## âœ… è§£å†³æ–¹æ¡ˆï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ ApeRAG Web ç•Œé¢ï¼ˆæœ€æ¨èï¼‰â­

**ä¼˜ç‚¹**ï¼šä¸éœ€è¦ç›´æ¥è¿æ¥ Googleï¼Œé€šè¿‡ ApeRAG åç«¯å¤„ç†

#### æ­¥éª¤ï¼š

1. **å¯åŠ¨ ApeRAG æœåŠ¡**ï¼ˆå¦‚æœè¿˜æ²¡å¯åŠ¨ï¼‰ï¼š

   ```powershell
   # æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
   docker-compose ps

   # å¦‚æœæœªè¿è¡Œï¼Œå¯åŠ¨æœåŠ¡
   docker-compose up -d
   ```

2. **é…ç½® Gemini Provider**ï¼š

   - æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:3000/web/workspace/providers`
   - æ‰¾åˆ° "Google Gemini" æä¾›å•†
   - ç‚¹å‡»"é…ç½®"
   - è¾“å…¥ä½ çš„ Gemini API Key
   - ä¿å­˜

3. **è·å– API Key**ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰ï¼š

   - è®¿é—®ï¼šhttps://aistudio.google.com/app/apikey
   - åˆ›å»ºæ–°çš„ API Key
   - å¤åˆ¶ä¿å­˜

4. **ä½¿ç”¨ Gemini æ¨¡å‹**ï¼š
   - åœ¨èŠå¤©ç•Œé¢é€‰æ‹© Gemini æ¨¡å‹
   - å¼€å§‹å¯¹è¯

**ä¸ºä»€ä¹ˆæ¨è**ï¼šApeRAG åç«¯å¯èƒ½å·²ç»é…ç½®äº†ä»£ç†æˆ–é€šè¿‡å…¶ä»–æ–¹å¼è®¿é—® Google API

---

### æ–¹æ¡ˆ 2ï¼šé…ç½®ç³»ç»Ÿä»£ç†

å¦‚æœä½ æœ‰å¯ç”¨çš„ä»£ç†æœåŠ¡å™¨ï¼ˆVPNã€ç§‘å­¦ä¸Šç½‘å·¥å…·ç­‰ï¼‰ï¼š

#### æ­¥éª¤ 1ï¼šæ£€æŸ¥ç³»ç»Ÿä»£ç†è®¾ç½®

```powershell
# æ£€æŸ¥å½“å‰ä»£ç†è®¾ç½®
netsh winhttp show proxy

# æ£€æŸ¥ç¯å¢ƒå˜é‡
Get-ChildItem Env: | Where-Object { $_.Name -like "*PROXY*" }
```

#### æ­¥éª¤ 2ï¼šé…ç½®ä»£ç†

**æ–¹æ³• Aï¼šé€šè¿‡ç¯å¢ƒå˜é‡ï¼ˆä¸´æ—¶ï¼‰**

```powershell
# è®¾ç½®ä»£ç†ï¼ˆæ›¿æ¢ä¸ºä½ çš„ä»£ç†åœ°å€å’Œç«¯å£ï¼‰
$env:HTTP_PROXY="http://127.0.0.1:7890"
$env:HTTPS_PROXY="http://127.0.0.1:7890"
$env:NO_PROXY="localhost,127.0.0.1"

# éªŒè¯è®¾ç½®
echo $env:HTTP_PROXY
echo $env:HTTPS_PROXY
```

**æ–¹æ³• Bï¼šé€šè¿‡ç³»ç»Ÿä»£ç†ï¼ˆæ°¸ä¹…ï¼‰**

```powershell
# è®¾ç½®ç³»ç»Ÿä»£ç†ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
netsh winhttp set proxy proxy-server="http=127.0.0.1:7890;https=127.0.0.1:7890" bypass-list="localhost,127.0.0.1"

# éªŒè¯
netsh winhttp show proxy
```

**æ–¹æ³• Cï¼šé€šè¿‡ Windows è®¾ç½®ï¼ˆå›¾å½¢ç•Œé¢ï¼‰**

1. æ‰“å¼€"è®¾ç½®" â†’ "ç½‘ç»œå’Œ Internet" â†’ "ä»£ç†"
2. é…ç½®æ‰‹åŠ¨ä»£ç†è®¾ç½®
3. è¾“å…¥ä»£ç†æœåŠ¡å™¨åœ°å€å’Œç«¯å£
4. ä¿å­˜

#### æ­¥éª¤ 3ï¼šæµ‹è¯•è¿æ¥

```powershell
# æµ‹è¯• Google API è¿æ¥
Test-NetConnection -ComputerName generativelanguage.googleapis.com -Port 443

# å¦‚æœæˆåŠŸï¼Œåº”è¯¥çœ‹åˆ° "TcpTestSucceeded : True"
```

---

### æ–¹æ¡ˆ 3ï¼šé…ç½® npm/Node.js ä»£ç†

å¦‚æœä½¿ç”¨ Gemini CLI å·¥å…·ï¼š

```powershell
# é…ç½® npm ä»£ç†
npm config set proxy http://127.0.0.1:7890
npm config set https-proxy http://127.0.0.1:7890

# éªŒè¯é…ç½®
npm config get proxy
npm config get https-proxy

# æ¸…é™¤ä»£ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰
# npm config delete proxy
# npm config delete https-proxy
```

---

### æ–¹æ¡ˆ 4ï¼šä½¿ç”¨ VPN æˆ–ç½‘ç»œå·¥å…·

1. **å¯åŠ¨ VPN å®¢æˆ·ç«¯**ï¼ˆå¦‚æœæœ‰ï¼‰
2. **è¿æ¥åˆ°å¯è®¿é—® Google æœåŠ¡çš„èŠ‚ç‚¹**
3. **é‡æ–°æµ‹è¯•è¿æ¥**ï¼š
   ```powershell
   Test-NetConnection -ComputerName generativelanguage.googleapis.com -Port 443
   ```

---

### æ–¹æ¡ˆ 5ï¼šæ£€æŸ¥é˜²ç«å¢™è®¾ç½®

```powershell
# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
Get-NetFirewallProfile | Select-Object Name, Enabled

# å¦‚æœé˜²ç«å¢™é˜»æ­¢ï¼Œå¯ä»¥ä¸´æ—¶å…³é—­æµ‹è¯•ï¼ˆä¸æ¨èç”Ÿäº§ç¯å¢ƒï¼‰
# Set-NetFirewallProfile -Profile Domain,Public,Private -Enabled False

# æˆ–è€…æ·»åŠ ä¾‹å¤–è§„åˆ™
New-NetFirewallRule -DisplayName "Allow Google API" -Direction Outbound -RemoteAddress 142.250.0.0/16 -Action Allow
```

---

## ğŸ§ª éªŒè¯æ­¥éª¤

å®Œæˆé…ç½®åï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤éªŒè¯ï¼š

### 1. æµ‹è¯•ç½‘ç»œè¿æ¥

```powershell
# æµ‹è¯• Google API
Test-NetConnection -ComputerName generativelanguage.googleapis.com -Port 443

# æµ‹è¯• DNS è§£æ
nslookup generativelanguage.googleapis.com

# æµ‹è¯• HTTPS è®¿é—®
Invoke-WebRequest -Uri "https://generativelanguage.googleapis.com" -UseBasicParsing
```

### 2. æµ‹è¯• Gemini CLIï¼ˆå¦‚æœä½¿ç”¨ï¼‰

```powershell
# è®¾ç½® API Key
$env:GOOGLE_API_KEY="your-api-key"

# æµ‹è¯• Gemini CLI
gemini --version
```

### 3. æµ‹è¯• ApeRAG é›†æˆ

1. è®¿é—®ï¼š`http://localhost:3000/web/workspace/providers`
2. ç¡®è®¤ Gemini Provider å·²é…ç½®
3. åœ¨èŠå¤©ç•Œé¢æµ‹è¯• Gemini æ¨¡å‹

---

## ğŸ“‹ å¸¸è§ä»£ç†ç«¯å£

å¦‚æœä½ ä½¿ç”¨å¸¸è§çš„ä»£ç†å·¥å…·ï¼Œé»˜è®¤ç«¯å£å¯èƒ½æ˜¯ï¼š

- **Clash**: `7890` (HTTP), `7891` (SOCKS)
- **V2Ray**: `10808` (SOCKS), `10809` (HTTP)
- **Shadowsocks**: `1080` (SOCKS)
- **å…¶ä»–å·¥å…·**: æŸ¥çœ‹å·¥å…·è®¾ç½®ä¸­çš„ç«¯å£é…ç½®

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šè®¾ç½®äº†ä»£ç†ä½†ä»ç„¶æ— æ³•è¿æ¥

**æ£€æŸ¥æ¸…å•**ï¼š

- [ ] ä»£ç†æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Ÿ
- [ ] ä»£ç†åœ°å€å’Œç«¯å£æ˜¯å¦æ­£ç¡®ï¼Ÿ
- [ ] ä»£ç†æ˜¯å¦éœ€è¦è®¤è¯ï¼Ÿ
- [ ] é˜²ç«å¢™æ˜¯å¦å…è®¸ä»£ç†è¿æ¥ï¼Ÿ

**æµ‹è¯•ä»£ç†**ï¼š

```powershell
# æµ‹è¯•ä»£ç†æ˜¯å¦å·¥ä½œ
$proxy = "http://127.0.0.1:7890"
$env:HTTP_PROXY = $proxy
$env:HTTPS_PROXY = $proxy
Invoke-WebRequest -Uri "https://www.google.com" -UseBasicParsing
```

### é—®é¢˜ 2ï¼šApeRAG åç«¯ä¹Ÿæ— æ³•è¿æ¥

**æ£€æŸ¥ ApeRAG é…ç½®**ï¼š

1. æ£€æŸ¥ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š

   ```powershell
   # æŸ¥çœ‹ç¯å¢ƒå˜é‡é…ç½®
   Get-Content envs\.env | Select-String -Pattern "PROXY|GOOGLE|GEMINI"
   ```

2. æ£€æŸ¥ Docker å®¹å™¨ç½‘ç»œï¼š

   ```powershell
   # æŸ¥çœ‹å®¹å™¨ç½‘ç»œé…ç½®
   docker-compose exec api env | Select-String -Pattern "PROXY"
   ```

3. åœ¨ Docker ä¸­é…ç½®ä»£ç†ï¼š
   ```yaml
   # åœ¨ docker-compose.yml ä¸­æ·»åŠ 
   environment:
     - HTTP_PROXY=http://host.docker.internal:7890
     - HTTPS_PROXY=http://host.docker.internal:7890
   ```

### é—®é¢˜ 3ï¼šDNS è§£æå¤±è´¥

```powershell
# æ›´æ¢ DNS æœåŠ¡å™¨
# ä½¿ç”¨ Google DNS
netsh interface ip set dns "ä»¥å¤ªç½‘" static 8.8.8.8
netsh interface ip add dns "ä»¥å¤ªç½‘" 8.8.4.4 index=2

# æˆ–ä½¿ç”¨ Cloudflare DNS
netsh interface ip set dns "ä»¥å¤ªç½‘" static 1.1.1.1
netsh interface ip add dns "ä»¥å¤ªç½‘" 1.0.0.1 index=2
```

---

## ğŸ“ æ¨èé…ç½®æ€»ç»“

### å¯¹äº ApeRAG é¡¹ç›®ï¼ˆæ¨èï¼‰

1. âœ… ä½¿ç”¨ ApeRAG Web ç•Œé¢é…ç½® Gemini
2. âœ… åœ¨ Web ç•Œé¢è¾“å…¥ API Key
3. âœ… é€šè¿‡ ApeRAG åç«¯è®¿é—® Gemini API

### å¯¹äº Gemini CLI å·¥å…·

1. é…ç½®ç³»ç»Ÿä»£ç†æˆ–ç¯å¢ƒå˜é‡ä»£ç†
2. è®¾ç½® `GOOGLE_API_KEY` ç¯å¢ƒå˜é‡
3. æµ‹è¯•è¿æ¥

---

## ğŸ†˜ ä»ç„¶æ— æ³•è§£å†³ï¼Ÿ

å¦‚æœä»¥ä¸Šæ–¹æ¡ˆéƒ½æ— æ³•è§£å†³é—®é¢˜ï¼š

1. **æ£€æŸ¥ç½‘ç»œç¯å¢ƒ**ï¼šç¡®è®¤æ˜¯å¦åœ¨å…¬å¸/å­¦æ ¡ç½‘ç»œï¼Œå¯èƒ½æœ‰ç‰¹æ®Šé™åˆ¶
2. **è”ç³»ç½‘ç»œç®¡ç†å‘˜**ï¼šè¯·æ±‚å¼€æ”¾ Google API è®¿é—®æƒé™
3. **ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ**ï¼š
   - ä½¿ç”¨å…¶ä»– LLM æä¾›å•†ï¼ˆOpenAIã€Anthropic ç­‰ï¼‰
   - ä½¿ç”¨ ApeRAG æ”¯æŒçš„å…¶ä»–æ¨¡å‹
   - è€ƒè™‘ä½¿ç”¨æœ¬åœ°æ¨¡å‹

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `GOOGLE_OAUTH_TIMEOUT_FIX.md` - OAuth è®¤è¯é—®é¢˜
- `GEMINI_API_FETCH_ERROR_FIX.md` - API è¿æ¥é—®é¢˜
- `QUICK_PROVIDER_SWITCH.md` - æä¾›å•†åˆ‡æ¢æŒ‡å—
