# äº‹æ•…é¢„æƒ³æ™ºèƒ½ä½“ - å‰åç«¯é›†æˆæµ‹è¯•æŒ‡å—

## âœ… å®ç°çŠ¶æ€æ€»ç»“

### åç«¯å®ç° âœ“

1. **æ™ºèƒ½ä½“ç±»** (`aperag/agent/specialists/accident_deduction_agent.py`)
   - âœ… å·²å®ç° `AccidentDeductionAgent` ç±»
   - âœ… ç»§æ‰¿è‡ª `BaseAgent`
   - âœ… å®ç°äº† `_execute` æ–¹æ³•
   - âœ… æ”¯æŒå¤šç§ä»»åŠ¡ç±»å‹ï¼š
     - äº‹æ•…é¢„æƒ³ç”Ÿæˆ
     - åº”æ€¥é¢„æ¡ˆç”Ÿæˆ
     - åº”æ€¥æ¼”ç»ƒè®¾è®¡
     - å†å²æ¡ˆä¾‹æ£€ç´¢

2. **æ™ºèƒ½ä½“æ³¨å†Œ** (`aperag/agent/registry.py`)
   - âœ… å·²åœ¨ `initialize_default_agents` ä¸­æ³¨å†Œ
   - âœ… ä»£ç è¡Œ114: `self.register(AccidentDeductionAgent(llm_service=llm_service))`

3. **æ™ºèƒ½ä½“é…ç½®** (`aperag/agent/agent_configs.py`)
   - âœ… å·²é…ç½® `ACCIDENT_DEDUCTION_AGENT_CONFIG`
   - âœ… åŒ…å«ç³»ç»Ÿæç¤ºè¯
   - âœ… åŒ…å«æŸ¥è¯¢æç¤ºè¯æ¨¡æ¿
   - âœ… é…ç½®äº†èƒ½åŠ›æ ‡ç­¾: `{"rag", "simulation", "analysis"}`
   - âœ… ä¼˜å…ˆçº§: 8

4. **è§’è‰²æšä¸¾** (`aperag/agent/core/models.py`)
   - âœ… å·²å®šä¹‰ `ACCIDENT_DEDUCTION = "accident_deduction"`

### å‰ç«¯å®ç° âœ“

1. **æ™ºèƒ½ä½“åˆ—è¡¨é¡µ** (`web/src/app/workspace/agents/page.tsx`)
   - âœ… å·²æ·»åŠ äº‹æ•…é¢„æƒ³æ™ºèƒ½ä½“å¡ç‰‡ (è¡Œ175-184)
   - âœ… å›¾æ ‡: `AlertTriangle`
   - âœ… é¢œè‰²: `text-pink-600`
   - âœ… èƒ½åŠ›æ ‡ç­¾: `['äº‹æ•…é¢„æƒ³', 'åº”æ€¥é¢„æ¡ˆ', 'æ¼”ç»ƒè®¾è®¡']`

2. **ä¸“å±å·¥ä½œå°é¡µé¢** (`web/src/app/workspace/agents/specific/accident_deduction/page.tsx`)
   - âœ… å·²åˆ›å»ºä¸“å±é¡µé¢
   - âœ… åŒ…å«æ ¸å¿ƒèƒ½åŠ›å±•ç¤º
   - âœ… åŒ…å«ä»»åŠ¡è¾“å…¥åŒºåŸŸ
   - âœ… åŒ…å«å¿«æ·å·¥å…·é¢æ¿

3. **è·¯ç”±é…ç½®** (`web/src/config/navigation-config.tsx`)
   - âœ… å·²é…ç½®è·¯ç”± `/workspace/agents/specific/accident_deduction`
   - âœ… å·²æ·»åŠ åˆ°å¯¼èˆªé…ç½®

4. **å›½é™…åŒ–** (`web/src/i18n/en-US.d.json.ts`)
   - âœ… å·²æ·»åŠ ç¿»è¯‘ `agent_accident_deduction: "Accident Deduction Specialist"`

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³•1: æµè§ˆå™¨æµ‹è¯•ï¼ˆæ¨èï¼‰

1. **è®¿é—®æ™ºèƒ½ä½“åˆ—è¡¨é¡µ**
   ```
   http://localhost:3000/workspace/agents
   ```
   
2. **æ‰¾åˆ°äº‹æ•…é¢„æƒ³ä¸“å®¶å¡ç‰‡**
   - æ ‡é¢˜: "The Accident Deduction Agent (äº‹æ•…é¢„æƒ³ä¸“å®¶)"
   - å›¾æ ‡: ç²‰è‰²è­¦å‘Šä¸‰è§’å½¢
   - èƒ½åŠ›: äº‹æ•…é¢„æƒ³ã€åº”æ€¥é¢„æ¡ˆã€æ¼”ç»ƒè®¾è®¡

3. **ç‚¹å‡»"æ¿€æ´»æ™ºèƒ½ä½“"æŒ‰é’®**
   - åº”è¯¥è·³è½¬åˆ°: `http://localhost:3000/workspace/agents/specific/accident_deduction`

4. **åœ¨ä¸“å±å·¥ä½œå°æµ‹è¯•**
   - åœ¨"ä»»åŠ¡æŒ‡ä»¤"æ–‡æœ¬æ¡†è¾“å…¥æµ‹è¯•æŸ¥è¯¢
   - ç‚¹å‡»"å‘é€æŒ‡ä»¤"æŒ‰é’®
   - æŸ¥çœ‹å“åº”ç»“æœ

### æ–¹æ³•2: APIæµ‹è¯•

ä½¿ç”¨ curl æˆ– Postman æµ‹è¯•åç«¯APIï¼š

```bash
# æµ‹è¯•äº‹æ•…é¢„æƒ³ç”Ÿæˆ
curl -X POST http://localhost:8000/api/agent/chat \
  -H "Content-Type: application/json" \
  -d '{
    "agent_role": "accident_deduction",
    "query": "#1ä¸»å˜é‡ç“¦æ–¯ä¿æŠ¤åŠ¨ä½œäº‹æ•…é¢„æƒ³",
    "user_id": "test_user"
  }'
```

### æ–¹æ³•3: Pythonæµ‹è¯•è„šæœ¬

åœ¨Dockerå®¹å™¨å†…è¿è¡Œï¼š

```bash
# è¿›å…¥å®¹å™¨
docker exec -it aperag-api bash

# è¿è¡ŒPythonæµ‹è¯•
python3 << 'EOF'
import asyncio
from aperag.agent.core.models import AgentRole, AgentState
from aperag.agent.registry import agent_registry

async def test():
    # åˆå§‹åŒ–æ³¨å†Œä¸­å¿ƒ
    agent_registry.initialize_default_agents(llm_service=None)
    
    # è·å–æ™ºèƒ½ä½“
    agent = agent_registry.get_agent(AgentRole.ACCIDENT_DEDUCTION)
    print(f"æ™ºèƒ½ä½“åç§°: {agent.name}")
    print(f"æ™ºèƒ½ä½“è§’è‰²: {agent.role}")
    
    # åˆ›å»ºçŠ¶æ€
    state = AgentState(session_id="test-001")
    
    # æ‰§è¡Œä»»åŠ¡
    result = await agent.run(state, {"task": "#1ä¸»å˜é‡ç“¦æ–¯ä¿æŠ¤åŠ¨ä½œäº‹æ•…é¢„æƒ³"})
    
    # æ˜¾ç¤ºç»“æœ
    print("\näº‹æ•…é¢„æƒ³æŠ¥å‘Š:")
    print(result["answer"][:500])  # æ˜¾ç¤ºå‰500å­—ç¬¦

asyncio.run(test())
EOF
```

---

## ğŸ“ æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•ç”¨ä¾‹1: äº‹æ•…é¢„æƒ³ç”Ÿæˆ

**è¾“å…¥**:
```
#1ä¸»å˜é‡ç“¦æ–¯ä¿æŠ¤åŠ¨ä½œäº‹æ•…é¢„æƒ³
```

**é¢„æœŸè¾“å‡º**:
- âœ… åŒ…å«äº‹æ•…æ ‡é¢˜
- âœ… åˆ—å‡ºå¯èƒ½çš„äº‹æ•…åŸå› 
- âœ… åˆ†æå¯èƒ½äº§ç”Ÿçš„åæœ
- âœ… æä¾›åº”æ€¥å¤„ç½®æ­¥éª¤
- âœ… åˆ—å‡ºç°åœºæ£€æŸ¥è¦ç‚¹
- âœ… è¯´æ˜å¤„ç†åŸåˆ™
- âœ… æ˜ç¡®æ¢å¤è¿è¡Œæ¡ä»¶

### æµ‹è¯•ç”¨ä¾‹2: åº”æ€¥é¢„æ¡ˆç”Ÿæˆ

**è¾“å…¥**:
```
ç”Ÿæˆå˜ç”µç«™ç«ç¾åº”æ€¥é¢„æ¡ˆ
```

**é¢„æœŸè¾“å‡º**:
- âœ… åŒ…å«é¢„æ¡ˆåç§°
- âœ… å®šä¹‰é€‚ç”¨èŒƒå›´
- âœ… åˆ—å‡ºåº”æ€¥ç»„ç»‡æ¶æ„
- âœ… æä¾›åº”æ€¥å“åº”æµç¨‹
- âœ… åŒ…å«ç´§æ€¥è”ç³»æ–¹å¼

### æµ‹è¯•ç”¨ä¾‹3: åº”æ€¥æ¼”ç»ƒè®¾è®¡

**è¾“å…¥**:
```
è®¾è®¡ä¸»å˜è·³é—¸åº”æ€¥æ¼”ç»ƒæ–¹æ¡ˆ
```

**é¢„æœŸè¾“å‡º**:
- âœ… åŒ…å«æ¼”ç»ƒåç§°
- âœ… æ˜ç¡®æ¼”ç»ƒç›®æ ‡
- âœ… åˆ—å‡ºå‚æ¼”äººå‘˜
- âœ… æè¿°æ¨¡æ‹Ÿåœºæ™¯
- âœ… æä¾›æ¼”ç»ƒè„šæœ¬ï¼ˆæ—¶é—´çº¿ï¼‰
- âœ… åˆ—å‡ºè€ƒæ ¸è¦ç‚¹

### æµ‹è¯•ç”¨ä¾‹4: å†å²æ¡ˆä¾‹æ£€ç´¢

**è¾“å…¥**:
```
æŸ¥è¯¢å†å²äº‹æ•…æ¡ˆä¾‹
```

**é¢„æœŸè¾“å‡º**:
- âœ… åˆ—å‡ºå†å²æ¡ˆä¾‹
- âœ… åŒ…å«æ¡ˆä¾‹ç¼–å·
- âœ… åŒ…å«æ—¶é—´ã€åœ°ç‚¹
- âœ… åŒ…å«æ•…éšœç±»å‹å’ŒåŸå› 
- âœ… æ€»ç»“ç»éªŒæ•™è®­

---

## ğŸ” éªŒè¯æ¸…å•

### åç«¯éªŒè¯

- [ ] æ™ºèƒ½ä½“å·²æ³¨å†Œåˆ° `agent_registry`
- [ ] æ™ºèƒ½ä½“å…ƒæ•°æ®å·²åŠ è½½
- [ ] æ™ºèƒ½ä½“å¯ä»¥æ­£å¸¸æ‰§è¡Œä»»åŠ¡
- [ ] æ€ç»´é“¾æ­£å¸¸è®°å½•
- [ ] è¿”å›ç»“æœæ ¼å¼æ­£ç¡®

### å‰ç«¯éªŒè¯

- [ ] æ™ºèƒ½ä½“å¡ç‰‡åœ¨åˆ—è¡¨é¡µæ˜¾ç¤º
- [ ] ç‚¹å‡»å¡ç‰‡å¯ä»¥è·³è½¬åˆ°ä¸“å±é¡µé¢
- [ ] ä¸“å±é¡µé¢æ­£å¸¸åŠ è½½
- [ ] å¯ä»¥è¾“å…¥ä»»åŠ¡æŒ‡ä»¤
- [ ] å¯ä»¥å‘é€æŒ‡ä»¤ï¼ˆå³ä½¿æ˜¯Mockå“åº”ï¼‰

### é›†æˆéªŒè¯

- [ ] å‰ç«¯å¯ä»¥è°ƒç”¨åç«¯API
- [ ] åç«¯å¯ä»¥è¿”å›æ­£ç¡®çš„å“åº”
- [ ] æ€ç»´é“¾å¯ä»¥å®æ—¶æ¨é€åˆ°å‰ç«¯
- [ ] ç»“æœå¯ä»¥æ­£ç¡®æ˜¾ç¤º

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•æ­¥éª¤

### æ­¥éª¤1: æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
docker ps
```

ç¡®è®¤ä»¥ä¸‹æœåŠ¡æ­£åœ¨è¿è¡Œ:
- `aperag-frontend` (ç«¯å£3000)
- `aperag-api` (ç«¯å£8000)

### æ­¥éª¤2: è®¿é—®å‰ç«¯

æ‰“å¼€æµè§ˆå™¨è®¿é—®:
```
http://localhost:3000/workspace/agents
```

### æ­¥éª¤3: æ‰¾åˆ°äº‹æ•…é¢„æƒ³ä¸“å®¶

åœ¨æ™ºèƒ½ä½“åˆ—è¡¨ä¸­æ‰¾åˆ°:
- æ ‡é¢˜: "The Accident Deduction Agent (äº‹æ•…é¢„æƒ³ä¸“å®¶)"
- å›¾æ ‡: ç²‰è‰²è­¦å‘Šä¸‰è§’å½¢ (AlertTriangle)
- æè¿°: "äº‹æ•…é¢„æƒ³ä¸åº”æ€¥æ¼”ç»ƒã€‚ç”Ÿæˆäº‹æ•…é¢„æƒ³æŠ¥å‘Šï¼Œåˆ¶å®šåº”æ€¥é¢„æ¡ˆï¼ŒæŒ‡å¯¼åº”æ€¥æ¼”ç»ƒã€‚"

### æ­¥éª¤4: æ¿€æ´»æ™ºèƒ½ä½“

ç‚¹å‡»"æ¿€æ´»æ™ºèƒ½ä½“"æŒ‰é’®ï¼Œåº”è¯¥è·³è½¬åˆ°:
```
http://localhost:3000/workspace/agents/specific/accident_deduction
```

### æ­¥éª¤5: æµ‹è¯•åŠŸèƒ½

åœ¨"ä»»åŠ¡æŒ‡ä»¤"æ–‡æœ¬æ¡†è¾“å…¥:
```
#1ä¸»å˜é‡ç“¦æ–¯ä¿æŠ¤åŠ¨ä½œäº‹æ•…é¢„æƒ³
```

ç‚¹å‡»"å‘é€æŒ‡ä»¤"æŒ‰é’®ã€‚

**æ³¨æ„**: å½“å‰å‰ç«¯é¡µé¢çš„"å‘é€æŒ‡ä»¤"æŒ‰é’®ä¼šå¼¹å‡ºä¸€ä¸ªalertï¼Œæ˜¾ç¤º"ä»»åŠ¡å·²æäº¤ç»™ Accident Deduction Agent (è°ƒç”¨ Agent API)"ã€‚è¿™æ˜¯å› ä¸ºå‰ç«¯è¿˜éœ€è¦è¿æ¥åˆ°å®é™…çš„WebSocket APIã€‚

---

## ğŸ”§ å¦‚æœé‡åˆ°é—®é¢˜

### é—®é¢˜1: æ™ºèƒ½ä½“æœªåœ¨åˆ—è¡¨æ˜¾ç¤º

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥å‰ç«¯ä»£ç  `web/src/app/workspace/agents/page.tsx`
2. ç¡®è®¤ `SPECIALIST_AGENTS` æ•°ç»„åŒ…å« `accident_deduction` é¡¹
3. é‡æ–°æ„å»ºå‰ç«¯: `docker-compose up -d --build frontend`

### é—®é¢˜2: ç‚¹å‡»æ¿€æ´»å404

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥è·¯ç”±é…ç½® `web/src/config/navigation-config.tsx`
2. ç¡®è®¤ä¸“å±é¡µé¢å­˜åœ¨ `web/src/app/workspace/agents/specific/accident_deduction/page.tsx`
3. é‡æ–°æ„å»ºå‰ç«¯

### é—®é¢˜3: åç«¯APIè°ƒç”¨å¤±è´¥

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥æ™ºèƒ½ä½“æ˜¯å¦å·²æ³¨å†Œ: 
   ```bash
   docker exec -it aperag-api python -c "from aperag.agent.registry import agent_registry; agent_registry.initialize_default_agents(); print(agent_registry.get_agent('accident_deduction'))"
   ```
2. æ£€æŸ¥APIæ—¥å¿—: `docker logs aperag-api`
3. é‡å¯APIæœåŠ¡: `docker-compose restart api`

---

## âœ… æˆåŠŸæ ‡å¿—

å½“æ‚¨çœ‹åˆ°ä»¥ä¸‹å†…å®¹æ—¶ï¼Œè¯´æ˜äº‹æ•…é¢„æƒ³æ™ºèƒ½ä½“å·²æˆåŠŸå®ç°å¹¶å¯ç”¨:

1. âœ… åœ¨ `http://localhost:3000/workspace/agents` çœ‹åˆ°äº‹æ•…é¢„æƒ³ä¸“å®¶å¡ç‰‡
2. âœ… ç‚¹å‡»å¡ç‰‡åè·³è½¬åˆ°ä¸“å±å·¥ä½œå°é¡µé¢
3. âœ… ä¸“å±å·¥ä½œå°é¡µé¢æ­£å¸¸æ˜¾ç¤ºï¼ŒåŒ…å«:
   - é¡µé¢æ ‡é¢˜: "äº‹æ•…é¢„æƒ³ä¸“å®¶ å·¥ä½œå°"
   - æ ¸å¿ƒèƒ½åŠ›å¡ç‰‡: äº‹æ•…æ¼”ç»ƒã€é¢„æ¡ˆç”Ÿæˆã€åæœåˆ†æ
   - ä»»åŠ¡æŒ‡ä»¤è¾“å…¥æ¡†
   - å‘é€æŒ‡ä»¤æŒ‰é’®
4. âœ… åç«¯æ™ºèƒ½ä½“å·²æ³¨å†Œå¹¶å¯ä»¥æ‰§è¡Œä»»åŠ¡

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ™ºèƒ½ä½“è®¾è®¡é€»è¾‘æ·±åº¦åˆ†æ.md](./æ™ºèƒ½ä½“è®¾è®¡é€»è¾‘æ·±åº¦åˆ†æ.md)
- [å¦‚ä½•å¿«é€Ÿå®ç°æ–°æ™ºèƒ½ä½“_æ— éœ€ä¿®æ”¹é€šç”¨ä»£ç .md](./å¦‚ä½•å¿«é€Ÿå®ç°æ–°æ™ºèƒ½ä½“_æ— éœ€ä¿®æ”¹é€šç”¨ä»£ç .md)
- [äº‹æ•…é¢„æƒ³æ™ºèƒ½ä½“å®ç°æ€»ç»“.md](./äº‹æ•…é¢„æƒ³æ™ºèƒ½ä½“å®Œæ•´å®ç°æ€»ç»“.md)

---

## ğŸ‰ æ€»ç»“

äº‹æ•…é¢„æƒ³æ™ºèƒ½ä½“å·²ç»**å®Œæ•´å®ç°**ï¼ŒåŒ…æ‹¬:

- âœ… åç«¯æ™ºèƒ½ä½“ç±» (æ–¹å¼ä¸‰: è‡ªå®šä¹‰æ™ºèƒ½ä½“)
- âœ… æ™ºèƒ½ä½“æ³¨å†Œå’Œé…ç½®
- âœ… å‰ç«¯æ™ºèƒ½ä½“å¡ç‰‡
- âœ… å‰ç«¯ä¸“å±å·¥ä½œå°é¡µé¢
- âœ… è·¯ç”±å’Œå¯¼èˆªé…ç½®
- âœ… å›½é™…åŒ–æ”¯æŒ

**å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼** ğŸš€
