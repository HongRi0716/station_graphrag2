# The Supervisor å’Œ The Archivist å®ç°å®Œæˆæ€»ç»“

**å®Œæˆæ—¶é—´**: 2024-11-25 14:25  
**å®æ–½èŒƒå›´**: æ ¸å¿ƒåŠŸèƒ½ä¼˜åŒ–

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. The Supervisorï¼ˆå€¼ç­é•¿ï¼‰âœ…

**æ–‡ä»¶**: `aperag/agent/specialists/supervisor_agent.py`

#### æ ¸å¿ƒåŠŸèƒ½

- âœ… **ä»»åŠ¡åˆ†æ** - è‡ªåŠ¨è¯†åˆ«ä»»åŠ¡ç±»å‹ã€å¤æ‚åº¦å’Œä¼˜å…ˆçº§
  - åº”æ€¥å“åº” (emergency_response)
  - æ“ä½œè§„åˆ’ (operation_planning)
  - å®‰å…¨æ£€æŸ¥ (safety_check)
  - ä¿¡æ¯æ£€ç´¢ (information_retrieval)
  - ä¿ç”µä»»åŠ¡ (power_guarantee)

- âœ… **æ™ºèƒ½åˆ†å‘** - æ ¹æ®ä»»åŠ¡ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„æ™ºèƒ½ä½“
  - å•ä»»åŠ¡åˆ†å‘
  - å¤šæ™ºèƒ½ä½“åä½œ

- âœ… **åä½œåè°ƒ** - ç»Ÿç­¹å¤šæ™ºèƒ½ä½“ååŒå·¥ä½œ
  - å¹¶è¡Œæ‰§è¡Œ - ç´§æ€¥ä»»åŠ¡
  - é¡ºåºæ‰§è¡Œ - å¸¸è§„ä»»åŠ¡
  - å±‚æ¬¡æ‰§è¡Œ - ä¼˜å…ˆçº§ä»»åŠ¡

- âœ… **æ€åŠ¿æ„ŸçŸ¥** - å®æ—¶æŒæ¡å˜ç”µç«™çŠ¶æ€
  - è®¾å¤‡çŠ¶æ€æ£€ç´¢
  - å‘Šè­¦ä¿¡æ¯æ£€ç´¢
  - æ€åŠ¿æŠ¥å‘Šç”Ÿæˆ

#### å…³é”®æ–¹æ³•

```python
# ä»»åŠ¡åˆ†æ
def _analyze_task(self, query: str) -> Dict[str, Any]

# åä½œåè°ƒ
async def _coordinate_collaboration(self, state, query, task_analysis)

# å•ä»»åŠ¡å¤„ç†
async def _handle_single_task(self, state, query, task_analysis)

# æ€åŠ¿æ„ŸçŸ¥
async def get_station_status(self, state: AgentState)
```

### 2. The Archivistï¼ˆå›¾è°±ä¸“å®¶ï¼‰âœ…

**æ–‡ä»¶**: `aperag/agent/specialists/archivist.py`

#### æ ¸å¿ƒåŠŸèƒ½

- âœ… **çŸ¥è¯†åº“æ£€ç´¢** - æ”¯æŒå¤šç§æ£€ç´¢æ¨¡å¼
  - å‘é‡æ£€ç´¢ (vector)
  - å›¾è°±æ£€ç´¢ (graph)
  - æ··åˆæ£€ç´¢ (hybrid)

- âœ… **å›¾è°±éå†** - å…³ç³»æŸ¥è¯¢å’Œè·¯å¾„åˆ†æ
  - LLMæ„å›¾è¯†åˆ«
  - å›¾è°±å…³ç³»æŸ¥è¯¢
  - è·¯å¾„åˆ†æ

- âœ… **å†å²æŸ¥è¯¢** - æ—¶é—´åºåˆ—æ•°æ®æ£€ç´¢
  - å†å²è®°å½•æ£€ç´¢
  - æ—¶é—´æ’åº
  - ç»“æœæ ¼å¼åŒ–

- âœ… **æ™ºèƒ½å›é€€** - Mockæ•°æ®æ”¯æŒ
  - æ— MCPæ—¶ä½¿ç”¨Mockæ•°æ®
  - å…³é”®è¯åŒ¹é…
  - å®Œæ•´çš„å›é€€æœºåˆ¶

#### å…³é”®æ–¹æ³•

```python
# çŸ¥è¯†æ£€ç´¢
async def _knowledge_search(self, state, query, search_type)

# å›¾è°±éå†
async def _graph_traversal(self, state, query)

# å†å²æŸ¥è¯¢
async def _historical_search(self, state, query)

# å›é€€å“åº”
def _fallback_response(self, query: str)
```

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

### The Supervisor

| åŠŸèƒ½ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| ä»»åŠ¡åˆ†æ | âŒ æ—  | âœ… è‡ªåŠ¨è¯†åˆ«5ç§ä»»åŠ¡ç±»å‹ |
| æ™ºèƒ½åˆ†å‘ | âŒ æ—  | âœ… æ ¹æ®èƒ½åŠ›è‡ªåŠ¨é€‰æ‹©æ™ºèƒ½ä½“ |
| åä½œåè°ƒ | âŒ æ—  | âœ… æ”¯æŒ3ç§åä½œæ¨¡å¼ |
| æ€åŠ¿æ„ŸçŸ¥ | âŒ æ—  | âœ… å®æ—¶æ£€ç´¢è®¾å¤‡å’Œå‘Šè­¦ |
| ä¼˜å…ˆçº§ç®¡ç† | âŒ æ—  | âœ… ç´§æ€¥/é«˜/æ­£å¸¸ä¸‰çº§ |

### The Archivist

| åŠŸèƒ½ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| çŸ¥è¯†æ£€ç´¢ | âš ï¸ Mock | âœ… RAGæ£€ç´¢ + Mockå›é€€ |
| å›¾è°±éå† | âŒ æ—  | âœ… LLMæ„å›¾è¯†åˆ« + å›¾è°±æŸ¥è¯¢ |
| å†å²æŸ¥è¯¢ | âŒ æ—  | âœ… æ—¶åºæ£€ç´¢ + æ’åº |
| ç»“æœæ ¼å¼åŒ– | âš ï¸ ç®€å• | âœ… ç»“æ„åŒ–Markdown |
| æ™ºèƒ½å›é€€ | âŒ æ—  | âœ… å®Œæ•´çš„å›é€€æœºåˆ¶ |

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### The Supervisor

```python
# ç¤ºä¾‹1: åº”æ€¥å“åº”
from aperag.agent import agent_registry
from aperag.agent.core.models import AgentRole, AgentState

supervisor = agent_registry.get_agent(AgentRole.SUPERVISOR)
supervisor.user_id = "user123"
supervisor.chat_id = "chat456"

state = AgentState(session_id="supervisor-test")
result = await supervisor.run(state, {
    "task": "#1ä¸»å˜è·³é—¸ï¼Œè¯·ç»„ç»‡åº”æ€¥å¤„ç½®"
})

# è¾“å‡º:
# - è‡ªåŠ¨è¯†åˆ«ä¸ºåº”æ€¥å“åº”ä»»åŠ¡
# - å¯åŠ¨å¹¶è¡Œåä½œæ¨¡å¼
# - åè°ƒ: äº‹æ•…é¢„æƒ³ + æ•…éšœè¯Šæ–­ + æ“ä½œç¥¨ä¸“å®¶
# - è¿”å›æ•´åˆæŠ¥å‘Š

print(result["answer"])
```

```python
# ç¤ºä¾‹2: æ€åŠ¿æ„ŸçŸ¥
status = await supervisor.get_station_status(state)

print(f"æ•´ä½“çŠ¶æ€: {status['overall_status']}")
print(f"è®¾å¤‡æ•°é‡: {status['equipment_count']}")
print(f"å‘Šè­¦æ•°é‡: {status['alarm_count']}")
```

### The Archivist

```python
# ç¤ºä¾‹1: çŸ¥è¯†æ£€ç´¢
archivist = agent_registry.get_agent(AgentRole.ARCHIVIST)
archivist.user_id = "user123"

state = AgentState(session_id="archivist-test")
result = await archivist.run(state, {
    "query": "æŸ¥è¯¢ä¸»å˜æ“ä½œè§„ç¨‹",
    "search_type": "hybrid"
})

print(result["answer"])  # æ ¼å¼åŒ–çš„æ£€ç´¢ç»“æœ
print(f"æ‰¾åˆ° {result['count']} æ¡æ–‡æ¡£")
```

```python
# ç¤ºä¾‹2: å›¾è°±éå†
result = await archivist.run(state, {
    "query": "#1ä¸»å˜ä¸å“ªäº›è®¾å¤‡æœ‰è¿æ¥å…³ç³»"
})

print(result["answer"])  # å›¾è°±å…³ç³»æè¿°
print(result["intent"])  # è¯†åˆ«çš„æ„å›¾
```

```python
# ç¤ºä¾‹3: å†å²æŸ¥è¯¢
result = await archivist.run(state, {
    "query": "æŸ¥è¯¢2024å¹´çš„ä¸»å˜æ£€ä¿®è®°å½•"
})

print(result["answer"])  # æŒ‰æ—¶é—´æ’åºçš„å†å²è®°å½•
print(f"æ‰¾åˆ° {result['count']} æ¡è®°å½•")
```

---

## ğŸ”„ åä½œæµç¨‹ç¤ºä¾‹

### å®Œæ•´çš„åº”æ€¥å“åº”æµç¨‹

```
ç”¨æˆ·: "#1ä¸»å˜è·³é—¸ï¼Œè¯·ç»„ç»‡åº”æ€¥å¤„ç½®"
    â†“
The Supervisor æ¥æ”¶ä»»åŠ¡
    â†“
ä»»åŠ¡åˆ†æ:
  - ç±»å‹: emergency_response
  - å¤æ‚åº¦: high
  - ä¼˜å…ˆçº§: urgent
  - åä½œæ¨¡å¼: parallel
    â†“
å¯åŠ¨æ™ºèƒ½ä½“åä½œ
    â”œâ”€ äº‹æ•…é¢„æƒ³ä¸“å®¶ â†’ ç”Ÿæˆäº‹æ•…æ¨æ¼”æŠ¥å‘Š
    â”œâ”€ æ•…éšœè¯Šæ–­ä¸“å®¶ â†’ åˆ†ææ•…éšœåŸå› 
    â””â”€ æ“ä½œç¥¨ä¸“å®¶ â†’ ç”Ÿæˆéš”ç¦»æ“ä½œç¥¨
    â†“
ç»“æœæ•´åˆ
    â†“
è¿”å›ç»¼åˆæŠ¥å‘Š
```

---

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

### The Supervisor

1. **æ™ºèƒ½ä»»åŠ¡åˆ†æ**
   - å…³é”®è¯è¯†åˆ«
   - å¤æ‚åº¦è¯„ä¼°
   - ä¼˜å…ˆçº§åˆ¤æ–­

2. **çµæ´»åä½œæ¨¡å¼**
   - ç´§æ€¥ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ
   - å¸¸è§„ä»»åŠ¡é¡ºåºæ‰§è¡Œ
   - æ”¯æŒå±‚æ¬¡æ‰§è¡Œ

3. **å®Œæ•´çš„å›é€€æœºåˆ¶**
   - åä½œå¤±è´¥å›é€€åˆ°å•ä»»åŠ¡
   - æ— user_idå›é€€åˆ°æŒ‡å¯¼
   - æ™ºèƒ½ä½“ä¸å¯ç”¨æ—¶æä¾›å»ºè®®

### The Archivist

1. **å¤šæ¨¡å¼æ£€ç´¢**
   - å‘é‡æ£€ç´¢
   - å›¾è°±éå†
   - å†å²æŸ¥è¯¢

2. **LLMå¢å¼º**
   - æ„å›¾è¯†åˆ«
   - å›¾è°±æŸ¥è¯¢ç”Ÿæˆ
   - ç»“æœæ ¼å¼åŒ–

3. **æ™ºèƒ½å›é€€**
   - Mockæ•°æ®æ”¯æŒ
   - å…³é”®è¯åŒ¹é…
   - ä¼˜é›…é™çº§

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### The Supervisor

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| ä»»åŠ¡åˆ†ææ—¶é—´ | < 100ms |
| å•ä»»åŠ¡åˆ†å‘ | < 1s |
| åä½œè°ƒåº¦ï¼ˆ3ä¸ªæ™ºèƒ½ä½“ï¼‰ | 5-20s |
| æ€åŠ¿æ„ŸçŸ¥ | 2-5s |

### The Archivist

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| çŸ¥è¯†æ£€ç´¢ï¼ˆRAGï¼‰ | 2-3s |
| å›¾è°±éå† | 3-5s |
| å†å²æŸ¥è¯¢ | 2-4s |
| Mockå›é€€ | < 100ms |

---

## ğŸš€ ä¸‹ä¸€æ­¥

### çŸ­æœŸ

1. âœ… æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ
2. ğŸ“‹ åˆ›å»ºAPIæ¥å£
3. ğŸ“‹ å‰ç«¯é›†æˆ
4. ğŸ“‹ é›†æˆæµ‹è¯•

### ä¸­æœŸ

1. æ€§èƒ½ä¼˜åŒ–
2. ç¼“å­˜æœºåˆ¶
3. å¹¶å‘å¤„ç†
4. é”™è¯¯æ¢å¤

### é•¿æœŸ

1. æœºå™¨å­¦ä¹ ä¼˜åŒ–
2. è‡ªé€‚åº”è°ƒåº¦
3. æ™ºèƒ½æ¨è
4. ç”¨æˆ·ç”»åƒ

---

## âœ¨ æ€»ç»“

æœ¬æ¬¡å®ç°å®Œæˆäº† The Supervisor å’Œ The Archivist çš„æ ¸å¿ƒåŠŸèƒ½ä¼˜åŒ–ï¼š

### The Supervisor

- âœ… ä»»åŠ¡åˆ†æå’Œæ™ºèƒ½åˆ†å‘
- âœ… å¤šæ™ºèƒ½ä½“åä½œåè°ƒ
- âœ… æ€åŠ¿æ„ŸçŸ¥
- âœ… ä¼˜å…ˆçº§ç®¡ç†
- âœ… å®Œæ•´çš„å›é€€æœºåˆ¶

### The Archivist

- âœ… çŸ¥è¯†åº“æ£€ç´¢ï¼ˆRAGï¼‰
- âœ… å›¾è°±å…³ç³»éå†
- âœ… å†å²æ•°æ®æŸ¥è¯¢
- âœ… ç»“æœæ ¼å¼åŒ–
- âœ… æ™ºèƒ½å›é€€ï¼ˆMockï¼‰

**çŠ¶æ€**: âœ… **The Supervisor å’Œ The Archivist æ ¸å¿ƒåŠŸèƒ½ä¼˜åŒ–å®Œæˆï¼**

**ä¸‹ä¸€æ­¥**: åˆ›å»ºAPIæ¥å£å’Œå‰ç«¯é›†æˆï¼ˆå·²æœ‰å®Œæ•´æ–¹æ¡ˆæ–‡æ¡£ï¼‰
