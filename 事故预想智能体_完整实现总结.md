# äº‹æ•…é¢„æƒ³æ™ºèƒ½ä½“ - å®Œæ•´å®ç°æ€»ç»“

> **çŠ¶æ€**: âœ… å®Œå…¨å®ç°å¹¶å¯ç”¨  
> **æ›´æ–°æ—¶é—´**: 2025-11-27  
> **å®ç°æ–¹å¼**: æ–¹å¼ä¸‰ï¼ˆè‡ªå®šä¹‰æ™ºèƒ½ä½“ï¼‰+ å®Œæ•´å‰åç«¯é›†æˆ

---

## ğŸ‰ å®ç°å®Œæˆåº¦: 100%

### âœ… åç«¯å®ç° (100%)

1. **æ™ºèƒ½ä½“ç±»** âœ“
   - æ–‡ä»¶: `aperag/agent/specialists/accident_deduction_agent.py`
   - ç±»å: `AccidentDeductionAgent`
   - ç»§æ‰¿: `BaseAgent`
   - åŠŸèƒ½: äº‹æ•…é¢„æƒ³ç”Ÿæˆã€åº”æ€¥é¢„æ¡ˆç”Ÿæˆã€æ¼”ç»ƒè®¾è®¡

2. **æ™ºèƒ½ä½“æ³¨å†Œ** âœ“
   - æ–‡ä»¶: `aperag/agent/registry.py`
   - è¡Œ114: `self.register(AccidentDeductionAgent(llm_service=llm_service))`
   - çŠ¶æ€: å·²æ³¨å†Œåˆ°ç³»ç»Ÿ

3. **æ™ºèƒ½ä½“é…ç½®** âœ“
   - æ–‡ä»¶: `aperag/agent/agent_configs.py`
   - é…ç½®: `ACCIDENT_DEDUCTION_AGENT_CONFIG`
   - å…ƒæ•°æ®: å®Œæ•´é…ç½®ï¼ˆæç¤ºè¯ã€å·¥å…·ã€èƒ½åŠ›æ ‡ç­¾ï¼‰

4. **è§’è‰²æšä¸¾** âœ“
   - æ–‡ä»¶: `aperag/agent/core/models.py`
   - æšä¸¾: `ACCIDENT_DEDUCTION = "accident_deduction"`

### âœ… å‰ç«¯å®ç° (100%)

1. **APIå®šä¹‰** âœ“
   - æ–‡ä»¶: `web/src/lib/api/agents.ts`
   - ç±»å‹: `AccidentDeductionRequest`, `AccidentDeductionResponse`
   - æ–¹æ³•: 
     - `generateAccidentDeduction()` - äº‹æ•…é¢„æƒ³ç”Ÿæˆ
     - `generateEmergencyPlan()` - åº”æ€¥é¢„æ¡ˆç”Ÿæˆ
     - `generateDrillDesign()` - æ¼”ç»ƒè®¾è®¡

2. **æ™ºèƒ½ä½“åˆ—è¡¨é¡µ** âœ“
   - æ–‡ä»¶: `web/src/app/workspace/agents/page.tsx`
   - å¡ç‰‡: äº‹æ•…é¢„æƒ³ä¸“å®¶ (è¡Œ175-184)
   - å›¾æ ‡: AlertTriangle (ç²‰è‰²)
   - è·¯ç”±: `/workspace/agents/specific/accident_deduction`

3. **ä¸“å±å·¥ä½œå°é¡µé¢** âœ“
   - æ–‡ä»¶: `web/src/app/workspace/agents/specific/accident_deduction/page.tsx`
   - åŠŸèƒ½:
     - âœ… çœŸå®APIè°ƒç”¨ï¼ˆä¸å†æ˜¯alertï¼‰
     - âœ… æ€ç»´é“¾å®æ—¶å±•ç¤º
     - âœ… ç»“æœå¯è§†åŒ–
     - âœ… å¿«æ·ä»»åŠ¡æŒ‰é’®
     - âœ… åŠ è½½çŠ¶æ€æ˜¾ç¤º
     - âœ… é”™è¯¯å¤„ç†

4. **è·¯ç”±é…ç½®** âœ“
   - æ–‡ä»¶: `web/src/config/navigation-config.tsx`
   - è·¯ç”±: å·²é…ç½®

5. **å›½é™…åŒ–** âœ“
   - æ–‡ä»¶: `web/src/i18n/en-US.d.json.ts`
   - ç¿»è¯‘: å·²æ·»åŠ 

---

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. äº‹æ•…é¢„æƒ³ç”Ÿæˆ

**è¾“å…¥ç¤ºä¾‹**:
```
#1ä¸»å˜é‡ç“¦æ–¯ä¿æŠ¤åŠ¨ä½œäº‹æ•…é¢„æƒ³
```

**åŠŸèƒ½**:
- åˆ†æäº‹æ•…åœºæ™¯
- åˆ—å‡ºå¯èƒ½åŸå› ï¼ˆå«æ¦‚ç‡ï¼‰
- åˆ†æäº‹æ•…åæœ
- æä¾›åº”æ€¥å¤„ç½®æªæ–½
- ç”Ÿæˆå®Œæ•´äº‹æ•…é¢„æƒ³æŠ¥å‘Š

### 2. åº”æ€¥é¢„æ¡ˆç”Ÿæˆ

**è¾“å…¥ç¤ºä¾‹**:
```
ç”Ÿæˆå˜ç”µç«™ç«ç¾åº”æ€¥é¢„æ¡ˆ
```

**åŠŸèƒ½**:
- å®šä¹‰é¢„æ¡ˆèŒƒå›´
- ç»„ç»‡æ¶æ„è®¾è®¡
- åº”æ€¥å“åº”æµç¨‹
- ç´§æ€¥è”ç³»æ–¹å¼

### 3. åº”æ€¥æ¼”ç»ƒè®¾è®¡

**è¾“å…¥ç¤ºä¾‹**:
```
è®¾è®¡ä¸»å˜è·³é—¸åº”æ€¥æ¼”ç»ƒæ–¹æ¡ˆ
```

**åŠŸèƒ½**:
- æ¼”ç»ƒç›®æ ‡è®¾å®š
- å‚æ¼”äººå‘˜å®‰æ’
- åœºæ™¯æ¨¡æ‹Ÿè®¾è®¡
- æ¼”ç»ƒè„šæœ¬ç”Ÿæˆ
- è€ƒæ ¸è¦ç‚¹åˆ—è¡¨

---

## ğŸ’¡ å‰ç«¯ç‰¹è‰²åŠŸèƒ½

### 1. å®æ—¶æ€ç»´é“¾å±•ç¤º

```typescript
{result.thinking_stream && (
  <Card>
    <CardHeader>
      <CardTitle>æ€è€ƒè¿‡ç¨‹</CardTitle>
    </CardHeader>
    <CardContent>
      {result.thinking_stream.map((step, index) => (
        <div key={index}>
          <Badge>{step.step_type}</Badge>
          <span>{step.description}</span>
        </div>
      ))}
    </CardContent>
  </Card>
)}
```

**æ•ˆæœ**: ç”¨æˆ·å¯ä»¥çœ‹åˆ°æ™ºèƒ½ä½“çš„æ€è€ƒè¿‡ç¨‹ï¼Œå¢å¼ºå¯è§£é‡Šæ€§

### 2. ç»“æ„åŒ–ç»“æœå±•ç¤º

```typescript
{result.deduction?.possible_causes && (
  <Card>
    <CardHeader>
      <CardTitle>å¯èƒ½åŸå› åˆ†æ</CardTitle>
    </CardHeader>
    <CardContent>
      {result.deduction.possible_causes.map((cause) => (
        <div>
          <span>{cause.cause}</span>
          <Badge>{cause.probability}</Badge>
          <p>{cause.description}</p>
        </div>
      ))}
    </CardContent>
  </Card>
)}
```

**æ•ˆæœ**: æ¸…æ™°å±•ç¤ºäº‹æ•…åŸå› ã€æ¦‚ç‡å’Œæè¿°

### 3. å¿«æ·ä»»åŠ¡æŒ‰é’®

```typescript
<div onClick={() => handleQuickTask('deduction', '#1ä¸»å˜é‡ç“¦æ–¯ä¿æŠ¤åŠ¨ä½œäº‹æ•…é¢„æƒ³')}>
  <h4>äº‹æ•…æ¼”ç»ƒ</h4>
  <p>ç”Ÿæˆäº‹æ•…æ¼”ç»ƒåœºæ™¯å’Œæ“ä½œæ­¥éª¤</p>
</div>
```

**æ•ˆæœ**: ä¸€é”®å¿«é€Ÿå¯åŠ¨å¸¸ç”¨ä»»åŠ¡

### 4. åŠ è½½çŠ¶æ€ä¸é”™è¯¯å¤„ç†

```typescript
{loading ? (
  <>
    <Loader2 className="animate-spin" />
    ç”Ÿæˆä¸­...
  </>
) : (
  <>
    <MessageSquare />
    å‘é€æŒ‡ä»¤
  </>
)}
```

**æ•ˆæœ**: æ¸…æ™°çš„åŠ è½½åé¦ˆå’Œé”™è¯¯æç¤º

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³•1: æµè§ˆå™¨æµ‹è¯•ï¼ˆæ¨èï¼‰

1. **è®¿é—®æ™ºèƒ½ä½“åˆ—è¡¨**
   ```
   http://localhost:3000/workspace/agents
   ```

2. **æ‰¾åˆ°äº‹æ•…é¢„æƒ³ä¸“å®¶å¡ç‰‡**
   - æ ‡é¢˜: "The Accident Deduction Agent (äº‹æ•…é¢„æƒ³ä¸“å®¶)"
   - å›¾æ ‡: ç²‰è‰²è­¦å‘Šä¸‰è§’å½¢
   - æè¿°: "äº‹æ•…é¢„æƒ³ä¸åº”æ€¥æ¼”ç»ƒã€‚ç”Ÿæˆäº‹æ•…é¢„æƒ³æŠ¥å‘Šï¼Œåˆ¶å®šåº”æ€¥é¢„æ¡ˆï¼ŒæŒ‡å¯¼åº”æ€¥æ¼”ç»ƒã€‚"

3. **ç‚¹å‡»"æ¿€æ´»æ™ºèƒ½ä½“"**
   - è·³è½¬åˆ°ä¸“å±å·¥ä½œå°

4. **æµ‹è¯•åŠŸèƒ½**
   - **æ–¹å¼A**: ç‚¹å‡»å¿«æ·ä»»åŠ¡æŒ‰é’®ï¼ˆäº‹æ•…æ¼”ç»ƒ/é¢„æ¡ˆç”Ÿæˆ/åæœåˆ†æï¼‰
   - **æ–¹å¼B**: åœ¨æ–‡æœ¬æ¡†è¾“å…¥è‡ªå®šä¹‰æŸ¥è¯¢ï¼Œç‚¹å‡»"å‘é€æŒ‡ä»¤"
   - **æ–¹å¼C**: ç‚¹å‡»å³ä¾§å¿«é€Ÿç¤ºä¾‹æŒ‰é’®

5. **æŸ¥çœ‹ç»“æœ**
   - æ€ç»´é“¾å±•ç¤ºï¼ˆå¯æŠ˜å ï¼‰
   - äº‹æ•…é¢„æƒ³æŠ¥å‘Šï¼ˆMarkdownæ ¼å¼ï¼‰
   - ç»“æ„åŒ–æ•°æ®ï¼ˆå¯èƒ½åŸå› ã€åº”æ€¥æªæ–½ç­‰ï¼‰

### æ–¹æ³•2: APIæµ‹è¯•

```bash
curl -X POST http://localhost:8000/api/agents/accident-deduction/generate \
  -H "Content-Type: application/json" \
  -d '{
    "query": "#1ä¸»å˜é‡ç“¦æ–¯ä¿æŠ¤åŠ¨ä½œäº‹æ•…é¢„æƒ³",
    "user_id": "test_user"
  }'
```

---

## ğŸ“Š ä¸å›¾è°±ä¸“å®¶çš„å¯¹æ¯”

| ç‰¹æ€§ | å›¾è°±ä¸“å®¶ | äº‹æ•…é¢„æƒ³ä¸“å®¶ |
|------|---------|-------------|
| å®ç°æ–¹å¼ | æ–¹å¼ä¸‰ï¼ˆè‡ªå®šä¹‰ï¼‰ | æ–¹å¼ä¸‰ï¼ˆè‡ªå®šä¹‰ï¼‰ |
| å‰ç«¯API | âœ… å®Œæ•´å®ç° | âœ… å®Œæ•´å®ç° |
| æ€ç»´é“¾å±•ç¤º | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| ç»“æœå¯è§†åŒ– | âœ… æ–‡æ¡£åˆ—è¡¨ | âœ… ç»“æ„åŒ–æ•°æ® |
| å¿«æ·åŠŸèƒ½ | âœ… çƒ­é—¨æœç´¢ | âœ… å¿«æ·ä»»åŠ¡ |
| åŠ è½½çŠ¶æ€ | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| é”™è¯¯å¤„ç† | âœ… Toastæç¤º | âœ… Toastæç¤º |

---

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›

### æ”¹è¿›å‰ï¼ˆalertç‰ˆæœ¬ï¼‰

```typescript
const handleStartTask = () => {
  alert("ä»»åŠ¡å·²æäº¤ç»™ Accident Deduction Agent (è°ƒç”¨ Agent API)"); 
};
```

**é—®é¢˜**: 
- âŒ åªæ˜¾ç¤ºalertï¼Œæ— å®é™…åŠŸèƒ½
- âŒ æ— æ³•è°ƒç”¨åç«¯API
- âŒ æ— æ³•å±•ç¤ºç»“æœ

### æ”¹è¿›åï¼ˆå®Œæ•´å®ç°ï¼‰

```typescript
const handleStartTask = async () => {
  setLoading(true);
  try {
    const response = await agentAPI.generateAccidentDeduction({
      query,
      user_id: user?.id || 'user-1',
    });
    setResult(response);
    toast.success('äº‹æ•…é¢„æƒ³ç”ŸæˆæˆåŠŸ');
  } catch (error) {
    toast.error('ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
  } finally {
    setLoading(false);
  }
};
```

**ä¼˜åŠ¿**:
- âœ… çœŸå®APIè°ƒç”¨
- âœ… åŠ è½½çŠ¶æ€ç®¡ç†
- âœ… é”™è¯¯å¤„ç†
- âœ… ç»“æœå±•ç¤º
- âœ… ç”¨æˆ·åé¦ˆ

---

## ğŸ”§ æŠ€æœ¯æ ˆ

### åç«¯
- **æ¡†æ¶**: FastAPI
- **æ™ºèƒ½ä½“åŸºç±»**: BaseAgent
- **å·¥å…·**: RAGæ£€ç´¢ã€LLMç”Ÿæˆã€æ¨¡æ¿æ¸²æŸ“
- **æ•°æ®æ¨¡å‹**: Pydantic

### å‰ç«¯
- **æ¡†æ¶**: Next.js 14 (App Router)
- **UIåº“**: shadcn/ui
- **çŠ¶æ€ç®¡ç†**: React Hooks
- **APIå®¢æˆ·ç«¯**: Axios
- **é€šçŸ¥**: Sonner (Toast)
- **å›½é™…åŒ–**: next-intl

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### åç«¯æ–‡ä»¶
```
aperag/agent/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ base.py                          # BaseAgentåŸºç±»
â”‚   â”œâ”€â”€ models.py                        # æ•°æ®æ¨¡å‹ï¼ˆå«AgentRoleæšä¸¾ï¼‰
â”‚   â””â”€â”€ generic.py                       # PromptDrivenAgent
â”œâ”€â”€ specialists/
â”‚   â””â”€â”€ accident_deduction_agent.py      # äº‹æ•…é¢„æƒ³æ™ºèƒ½ä½“ âœ…
â”œâ”€â”€ registry.py                          # æ™ºèƒ½ä½“æ³¨å†Œä¸­å¿ƒ âœ…
â”œâ”€â”€ agent_configs.py                     # æ™ºèƒ½ä½“é…ç½® âœ…
â””â”€â”€ prompts.py                           # æç¤ºè¯å®šä¹‰
```

### å‰ç«¯æ–‡ä»¶
```
web/src/
â”œâ”€â”€ lib/api/
â”‚   â””â”€â”€ agents.ts                        # APIå®šä¹‰ âœ…
â”œâ”€â”€ app/workspace/agents/
â”‚   â”œâ”€â”€ page.tsx                         # æ™ºèƒ½ä½“åˆ—è¡¨é¡µ âœ…
â”‚   â””â”€â”€ specific/accident_deduction/
â”‚       â””â”€â”€ page.tsx                     # ä¸“å±å·¥ä½œå° âœ…
â”œâ”€â”€ config/
â”‚   â””â”€â”€ navigation-config.tsx            # è·¯ç”±é…ç½® âœ…
â””â”€â”€ i18n/
    â””â”€â”€ en-US.d.json.ts                  # å›½é™…åŒ– âœ…
```

---

## âœ… éªŒè¯æ¸…å•

- [x] åç«¯æ™ºèƒ½ä½“ç±»å·²å®ç°
- [x] æ™ºèƒ½ä½“å·²æ³¨å†Œåˆ°ç³»ç»Ÿ
- [x] æ™ºèƒ½ä½“é…ç½®å®Œæ•´
- [x] å‰ç«¯APIå®šä¹‰å®Œæ•´
- [x] æ™ºèƒ½ä½“å¡ç‰‡åœ¨åˆ—è¡¨æ˜¾ç¤º
- [x] ä¸“å±å·¥ä½œå°é¡µé¢å®Œæ•´
- [x] çœŸå®APIè°ƒç”¨å®ç°
- [x] æ€ç»´é“¾å±•ç¤ºå®ç°
- [x] ç»“æœå¯è§†åŒ–å®ç°
- [x] åŠ è½½çŠ¶æ€ç®¡ç†
- [x] é”™è¯¯å¤„ç†å®Œå–„
- [x] å¿«æ·åŠŸèƒ½å®ç°
- [x] è·¯ç”±é…ç½®æ­£ç¡®
- [x] å›½é™…åŒ–æ”¯æŒ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æœåŠ¡

```bash
# ç¡®ä¿DockeræœåŠ¡è¿è¡Œ
docker-compose up -d
```

### 2. è®¿é—®å‰ç«¯

```
http://localhost:3000/workspace/agents
```

### 3. æµ‹è¯•åŠŸèƒ½

1. æ‰¾åˆ°"äº‹æ•…é¢„æƒ³ä¸“å®¶"å¡ç‰‡
2. ç‚¹å‡»"æ¿€æ´»æ™ºèƒ½ä½“"
3. é€‰æ‹©å¿«æ·ä»»åŠ¡æˆ–è¾“å…¥è‡ªå®šä¹‰æŸ¥è¯¢
4. ç‚¹å‡»"å‘é€æŒ‡ä»¤"
5. æŸ¥çœ‹æ€ç»´é“¾å’Œç»“æœ

---

## ğŸ‰ æ€»ç»“

äº‹æ•…é¢„æƒ³æ™ºèƒ½ä½“å·²ç»**å®Œå…¨å®ç°**ï¼ŒåŒ…æ‹¬ï¼š

âœ… **åç«¯**: è‡ªå®šä¹‰æ™ºèƒ½ä½“ç±» + å®Œæ•´é…ç½®  
âœ… **å‰ç«¯**: çœŸå®APIè°ƒç”¨ + å®Œæ•´UI  
âœ… **é›†æˆ**: å‰åç«¯å®Œå…¨æ‰“é€š  
âœ… **åŠŸèƒ½**: äº‹æ•…é¢„æƒ³ã€åº”æ€¥é¢„æ¡ˆã€æ¼”ç»ƒè®¾è®¡  
âœ… **ä½“éªŒ**: æ€ç»´é“¾å¯è§†åŒ– + ç»“æœç»“æ„åŒ–å±•ç¤º  

**ç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼** ğŸš€

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ™ºèƒ½ä½“è®¾è®¡é€»è¾‘æ·±åº¦åˆ†æ.md](./æ™ºèƒ½ä½“è®¾è®¡é€»è¾‘æ·±åº¦åˆ†æ.md)
- [å¦‚ä½•å¿«é€Ÿå®ç°æ–°æ™ºèƒ½ä½“_æ— éœ€ä¿®æ”¹é€šç”¨ä»£ç .md](./å¦‚ä½•å¿«é€Ÿå®ç°æ–°æ™ºèƒ½ä½“_æ— éœ€ä¿®æ”¹é€šç”¨ä»£ç .md)
- [äº‹æ•…é¢„æƒ³æ™ºèƒ½ä½“_æµ‹è¯•æŒ‡å—.md](./äº‹æ•…é¢„æƒ³æ™ºèƒ½ä½“_æµ‹è¯•æŒ‡å—.md)
